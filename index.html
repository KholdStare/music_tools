<html>

<head>
    <style>
        fret-board {
            display: flex;
            flex-direction: column;

            & string:first-child fret::after {
                content: "";
                position: absolute;
                right: 0;
                top: 50%;
                height: 50%;
                border-right: 4px solid darkgray;
            }

            & string:last-child fret::after {
                content: "";
                position: absolute;
                right: 0;
                top: 0;
                height: 50%;
                border-right: 4px solid darkgray;
            }
        }

        string {
            display: flex;
            flex-direction: row;

            label {
                display: flex;
                width: 2rem;
                text-align: center;
                align-items: center;
            }
        }

        /* vertical divider, size, annotations */
        nut,
        fret {
            position: relative;
            width: 5rem;
            height: 2rem;
            display: flex;
            justify-content: center;
            align-items: center;

            annot {
                font-size: 0.7rem;
                text-align: center;
                background-color: lightblue;
                z-index: 1;
                border-radius: 50%;
                padding: 0.5rem;
                width: 0.6rem;
                height: 0.6rem;
            }

            &::after {
                content: "";
                position: absolute;
                right: 0;
                height: 100%;
                border-right: 4px solid darkgray;
            }
        }

        /* string in fret */
        fret::before {
            content: "";
            position: absolute;
            top: 50%;
            width: 100%;
            height: 1px;
            background-color: black;
        }
    </style>
</head>

<body>
    <!-- TODO unhardcode -->

    <fret-board>
        <!-- <string>
                <nut></nut>
                <fret></fret>
                <fret></fret>
                <fret></fret>
                <fret></fret>
                <fret><annot>A</annot></fret>
            </string>
            <string>
                <nut><annot>B</annot></nut>
                <fret></fret>
                <fret></fret>
                <fret></fret>
                <fret></fret>
                <fret></fret>
            </string>
            <string>
                <nut></nut>
                <fret></fret>
                <fret></fret>
                <fret></fret>
                <fret><annot>Db</annot></fret>
                <fret></fret>
            </string> -->
    </fret-board>
    <script>
        const fretboardData = {
            "totalFrets": 12,
            "tuning": ["E", "A", "D", "G", "B", "E"],
            "annotations": [
                [
                    [0, 5, "A"],
                    [1, 4, "Db"],
                    [4, 10, "G"]
                ]
            ]
        }

        const fretboardElem = document.getElementsByTagName("fret-board")[0];
        const numStrings = fretboardData.tuning.length;

        // Draw the fretboard
        for (let i = 0; i < numStrings; i++) {
            const stringElem = fretboardElem.appendChild(document.createElement("string"));
            const stringIndex = numStrings - i - 1;
            stringElem.setAttribute("data-string-index", stringIndex.toString());

            // String open string note label
            const stringNote = fretboardData.tuning[stringIndex];
            // stringElem.appendChild(document.createElement("label")).appendChild(document.createTextNode(stringNote));
            stringElem.appendChild(document.createElement("label")).textContent = stringNote;

            stringElem.appendChild(document.createElement("nut")).setAttribute("data-fret-index", "0");

            for (let j = 0; j < fretboardData.totalFrets; j++) {
                stringElem.appendChild(document.createElement("fret")).setAttribute("data-fret-index", (j + 1).toString());
            }
        }

        // Draw the annotations
        for (const layerIndex in fretboardData.annotations) {
            const layer = fretboardData.annotations[layerIndex];
            for (const annotation of layer) {
                const [i, j, text] = annotation;
                const fretElem = document.querySelector(`[data-string-index="${i}"]`).querySelector(`[data-fret-index="${j}"]`);

                const annotElem = fretElem.appendChild(document.createElement("annot"));
                annotElem.setAttribute("data-annot-layer", layerIndex.toString());
                annotElem.textContent = text;
            }
        }
    </script>

</body>

</html>